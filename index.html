<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ÙØ§Ø¯ÙŠ Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ© â€“ Ø§Ø­Ø³Ø¨ Ù…Ù†Ø¸ÙˆÙ…ØªÙƒ</title>
<meta name="theme-color" content="#020617">

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
:root{
  --bg:#020617;
  --accent:#22c55e;
  --accent2:#0ea5e9;
  --border:#1e293b;
  --text:#e5e7eb;
}
body{
  margin:0;
  background:
    linear-gradient(rgba(2,6,23,.95),rgba(2,6,23,.95)),
    radial-gradient(circle at top,#0ea5e933,transparent 60%);
  color:var(--text);
  font-family:system-ui;
}
.container{max-width:1100px;margin:auto;padding:12px}
h1{text-align:center;color:#22c55e}
.card{
  background:#020617cc;
  border:1px solid var(--border);
  border-radius:16px;
  padding:14px;
  margin-bottom:14px;
}
.btn{
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  border:none;
  padding:10px 16px;
  border-radius:14px;
  font-weight:900;
  cursor:pointer;
}
.btn.ghost{background:#020617;color:#38bdf8;border:1px solid var(--border)}
.steps{display:grid;grid-template-columns:1fr;gap:14px}
@media(min-width:900px){.steps{grid-template-columns:300px 1fr}}
.step-item{
  padding:12px;border-radius:12px;
  border:1px solid var(--border);
  margin-bottom:8px;
  cursor:pointer;
}
.step-item.active{
  background:linear-gradient(135deg,#22c55e,#0ea5e9);
  color:#022c22;
}
.device-cards{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:12px;
}
.dev-card{
  border:1px solid var(--border);
  border-radius:16px;
  padding:12px;
  text-align:center;
  cursor:pointer;
}
.dev-card.added{border-color:#22c55e}
.device{
  display:grid;
  grid-template-columns:1fr 60px 90px 90px;
  gap:8px;
  align-items:center;
  margin-bottom:8px;
}
.hours{
  display:flex;
  flex-direction:column;
  align-items:center;
  border:1px solid var(--border);
  border-radius:12px;
}
.hours button{
  border:none;
  width:30px;height:30px;
  border-radius:50%;
  background:#22c55e;
  font-weight:900;
}
.summary{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:12px;
}
.box{
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  text-align:center;
}
.value{color:#22c55e;font-weight:900;font-size:18px}
.panel{display:none}
.panel.active{display:block}
</style>
</head>

<body>
<div class="container">
<h1>ÙØ§Ø¯ÙŠ Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ© â˜€ï¸<br>Ø§Ø­Ø³Ø¨ Ù…Ù†Ø¸ÙˆÙ…ØªÙƒ</h1>

<div class="steps">
<div class="card">
  <div class="step-item active" onclick="go(1)">â‘  Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</div>
  <div class="step-item" onclick="go(2)">â‘¡ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„</div>
  <div class="step-item" onclick="go(3)">â‘¢ Ø§Ù„Ù†ØªÙŠØ¬Ø©</div>
</div>

<div>
<div id="s1" class="card panel active">
  <div class="device-cards" id="cards"></div>
  <button class="btn" onclick="go(2)">Ø§Ù„ØªØ§Ù„ÙŠ</button>
</div>

<div id="s2" class="card panel">
  <div id="devices"></div>
  <button class="btn ghost" onclick="go(1)">Ø±Ø¬ÙˆØ¹</button>
  <button class="btn" onclick="go(3)">Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
</div>

<div id="s3" class="card panel">
  <div id="result" class="summary"></div>
  <br>
  <button class="btn" onclick="saveImage()">ğŸ’¾ Ø­ÙØ¸ ÙƒØµÙˆØ±Ø©</button>
  <button class="btn" onclick="sendWhatsApp()">ğŸ“² ÙˆØ§ØªØ³Ø§Ø¨</button>
</div>
</div>
</div>
</div>

<script>
const PANEL_WATT = 590;
const SUN_HOURS = 5;
const BATTERY_MARGIN = 1.2;

const catalog=[
 {n:"Ø´Ø§Ø´Ø©",w:150,i:"ğŸ“º"},
 {n:"Ø«Ù„Ø§Ø¬Ø©",w:200,i:"ğŸ§Š"},
 {n:"Ù…Ø±ÙˆØ­Ø©",w:70,i:"ğŸŒ€"},
 {n:"Ù…ÙƒÙŠÙ Ù†Ø³Ù…Ø©",w:250,i:"â„ï¸"},
 {n:"ØºØ³Ø§Ù„Ø©",w:600,i:"ğŸ§º"},
 {n:"Ù„Ù…Ø¨Ø©",w:30,i:"ğŸ’¡"},
 {n:"Ù„Ø§Ø¨ØªÙˆØ¨",w:100,i:"ğŸ’»"},
 {n:"Ù…ÙˆØªÙˆØ± Ù†Øµ Ø­ØµØ§Ù†",w:400,i:"ğŸš°"},
 {n:"Ù…ÙˆØªÙˆØ± 1 Ø­ØµØ§Ù†",w:750,i:"ğŸš¿"}
];

let devices=[];
const cards=document.getElementById("cards");
const devicesDiv=document.getElementById("devices");
const resultDiv=document.getElementById("result");

catalog.forEach(d=>{
  const c=document.createElement("div");
  c.className="dev-card";
  c.innerHTML=`<div style="font-size:28px">${d.i}</div><b>${d.n}</b><br>${d.w} W`;
  c.onclick=()=>{
    if(!devices.find(v=>v.n==d.n))
      devices.push({n:d.n,w:d.w,i:d.i,c:1,day:1,night:0});
    c.classList.add("added");
    renderDevices();
  };
  cards.appendChild(c);
});

function go(n){
  document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));
  document.querySelectorAll(".step-item").forEach((s,i)=>s.classList.toggle("active",i+1==n));
  document.getElementById("s"+n).classList.add("active");
  calc();
}

function renderDevices(){
  devicesDiv.innerHTML="";
  devices.forEach((d,i)=>{
    devicesDiv.innerHTML+=`
    <div class="device">
      <div>${d.i} ${d.n}</div>
      <input type="number" min="1" value="${d.c}"
        onchange="devices[${i}].c=this.value||1;calc()">
      <div class="hours">
        <button onclick="devices[${i}].day++;renderDevices()">+</button>
        Ù†Ù‡Ø§Ø± ${d.day}
        <button onclick="devices[${i}].day>0&&devices[${i}].day--;renderDevices()">âˆ’</button>
      </div>
      <div class="hours">
        <button onclick="devices[${i}].night++;renderDevices()">+</button>
        Ù„ÙŠÙ„ ${d.night}
        <button onclick="devices[${i}].night>0&&devices[${i}].night--;renderDevices()">âˆ’</button>
      </div>
    </div>`;
  });
  calc();
}

function inverter(w){
  if(w<800) return "Ø§Ù†ÙÙŠØ±ØªØ± 2.2 ÙƒÙŠÙ„Ùˆ";
  if(w<1800) return "Ø§Ù†ÙÙŠØ±ØªØ± 3.2 ÙƒÙŠÙ„Ùˆ";
  if(w<3300) return "Ø§Ù†ÙÙŠØ±ØªØ± 4.2 ÙƒÙŠÙ„Ùˆ";
  if(w<4800) return "Ø§Ù†ÙÙŠØ±ØªØ± 6.2 ÙƒÙŠÙ„Ùˆ";
  if(w<5800) return "Ø§Ù†ÙÙŠØ±ØªØ± 8.2 ÙƒÙŠÙ„Ùˆ";
  if(w<7800) return "Ø§Ù†ÙÙŠØ±ØªØ± 10.2 ÙƒÙŠÙ„Ùˆ";
  return "ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ù‡Ù†Ø¯Ø³ Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø©";
}

let data={};

function calc(){
  let inst=0, day=0, night=0;
  devices.forEach(d=>{
    inst+=d.w*d.c;
    day+=d.w*d.c*d.day;
    night+=d.w*d.c*d.night;
  });

  const batteryKwh=((night*BATTERY_MARGIN)/1000).toFixed(2);
  const panels=Math.ceil(day/(PANEL_WATT*SUN_HOURS));

  data={inst,day,night,total:day+night,batteryKwh,panels,inv:inverter(inst)};

  resultDiv.innerHTML=`
    <div class="box"><div>ğŸ”Œ Ø§Ù„Ù‚Ø¯Ø±Ø© Ø§Ù„Ù„Ø­Ø¸ÙŠØ©</div><div class="value">${inst} W</div></div>
    <div class="box"><div>â˜€ï¸ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù†Ù‡Ø§Ø±</div><div class="value">${day} Wh</div></div>
    <div class="box"><div>ğŸŒ™ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù„ÙŠÙ„</div><div class="value">${night} Wh</div></div>
    <div class="box"><div>ğŸ“Š Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„ÙƒÙ„ÙŠ</div><div class="value">${day+night} Wh</div></div>
    <div class="box"><div>ğŸ”‹ Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©</div><div class="value">${batteryKwh} kWh</div></div>
    <div class="box"><div>ğŸŒ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù„ÙˆØ§Ø­</div><div class="value">${panels}</div></div>
    <div class="box"><div>âš¡ Ø§Ù„Ø§Ù†ÙÙŠØ±ØªØ±</div><div class="value">${data.inv}</div></div>
  `;
}

function saveImage(){
  html2canvas(resultDiv).then(c=>{
    const a=document.createElement("a");
    a.download="solar-result.png";
    a.href=c.toDataURL();
    a.click();
  });
}

function sendWhatsApp(){
  const msg=`Ù…Ø±Ø­Ø¨Ø§ØŒ
Ø£Ø±ØºØ¨ ÙÙŠ Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ù„Ù…Ù†Ø¸ÙˆÙ…Ø© Ø·Ø§Ù‚Ø© Ø´Ù…Ø³ÙŠØ©:

ğŸ”Œ Ø§Ù„Ù‚Ø¯Ø±Ø© Ø§Ù„Ù„Ø­Ø¸ÙŠØ©: ${data.inst} W
â˜€ï¸ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù†Ù‡Ø§Ø±: ${data.day} Wh
ğŸŒ™ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù„ÙŠÙ„: ${data.night} Wh
ğŸ“Š Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„ÙƒÙ„ÙŠ: ${data.total} Wh
ğŸ”‹ Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©: ${data.batteryKwh} kWh
âš¡ Ø§Ù„Ø§Ù†ÙÙŠØ±ØªØ±: ${data.inv}
ğŸŒ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù„ÙˆØ§Ø­: ${data.panels}

Ø´ÙƒØ±Ø§Ù‹`;
  window.open("https://wa.me/249912341391?text="+encodeURIComponent(msg));
}
</script>
</body>
  </html>
