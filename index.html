<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ÙØ§Ø¯ÙŠ Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ© â€“ Ø­Ø§Ø³Ø¨Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
<meta name="description" content="Ø§Ø­Ø³Ø¨ Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙƒ Ù…Ù† Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ© Ø¨Ø¯Ù‚Ø© ÙˆØ§Ø­ØªØ±Ø§ÙÙŠØ©">
<meta name="theme-color" content="#0f172a">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
:root {
  --primary: #0f766e;          /* Ù„ÙˆÙ† Ø±Ø¦ÙŠØ³ÙŠ Ø£ÙƒØ«Ø± Ø§Ø­ØªØ±Ø§ÙÙŠØ© */
  --secondary: #0ea5e9;        /* Ù„ÙˆÙ† Ø«Ø§Ù†ÙˆÙŠ */
  --accent: #10b981;           /* Ù„ÙˆÙ† Ù„Ù„ØªØ£ÙƒÙŠØ¯ */
  --dark: #0f172a;             /* Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ†Ø© */
  --light: #f8fafc;            /* Ù†Øµ ÙØ§ØªØ­ */
  --card-bg: #1e293b;          /* Ø®Ù„ÙÙŠØ© Ø§Ù„ÙƒØ±ÙˆØª */
  --border: #334155;           /* Ù„ÙˆÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ */
  --success: #22c55e;          /* Ù†Ø¬Ø§Ø­ */
  --warning: #f59e0b;          /* ØªØ­Ø°ÙŠØ± */
  --radius: 16px;              /* Ø²ÙˆØ§ÙŠØ§ Ø¯Ø§Ø¦Ø±ÙŠØ© */
  --shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
  --transition: all 0.3s ease;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', 'Tahoma', Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  color: var(--light);
  line-height: 1.6;
  min-height: 100vh;
  padding: 20px;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± */
.header {
  text-align: center;
  margin-bottom: 40px;
  padding: 20px;
  border-bottom: 2px solid var(--primary);
}

.logo {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  margin-bottom: 15px;
}

.logo i {
  font-size: 2.5rem;
  color: var(--accent);
}

.logo h1 {
  font-size: 2.2rem;
  background: linear-gradient(to right, var(--accent), var(--secondary));
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  font-weight: 700;
}

.subtitle {
  color: #94a3b8;
  font-size: 1.1rem;
  max-width: 600px;
  margin: 0 auto;
}

/* Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØµÙØ­ */
.steps-container {
  display: flex;
  flex-direction: column;
  gap: 30px;
}

.steps-sidebar {
  background: var(--card-bg);
  border-radius: var(--radius);
  padding: 25px;
  box-shadow: var(--shadow);
}

.steps-list {
  list-style: none;
}

.step-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 18px 20px;
  margin-bottom: 15px;
  border-radius: 12px;
  cursor: pointer;
  transition: var(--transition);
  border: 1px solid transparent;
}

.step-item:hover {
  background: rgba(255, 255, 255, 0.05);
  border-color: var(--border);
}

.step-item.active {
  background: linear-gradient(135deg, var(--primary), #115e59);
  border-color: var(--accent);
  box-shadow: 0 5px 15px rgba(15, 118, 110, 0.3);
}

.step-number {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 1.1rem;
}

.step-item.active .step-number {
  background: white;
  color: var(--primary);
}

.step-info h3 {
  font-size: 1.1rem;
  margin-bottom: 5px;
}

.step-info p {
  font-size: 0.9rem;
  color: #94a3b8;
}

.step-item.active .step-info p {
  color: rgba(255, 255, 255, 0.9);
}

/* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
.main-content {
  flex: 1;
}

.panel {
  background: var(--card-bg);
  border-radius: var(--radius);
  padding: 30px;
  box-shadow: var(--shadow);
  display: none;
  animation: fadeIn 0.5s ease;
}

.panel.active {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Ø´Ø§Ø´Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© */
.section-title {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 25px;
  font-size: 1.4rem;
}

.section-title i {
  color: var(--accent);
}

.catalog {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 15px;
  margin-bottom: 30px;
}

.device-card {
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid var(--border);
  border-radius: 12px;
  padding: 20px 15px;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
}

.device-card:hover {
  transform: translateY(-5px);
  border-color: var(--primary);
  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
}

.device-card.added {
  border-color: var(--success);
  background: rgba(34, 197, 94, 0.1);
}

.device-icon {
  font-size: 2.5rem;
  margin-bottom: 10px;
}

.device-name {
  font-weight: 600;
  margin-bottom: 5px;
  font-size: 1.1rem;
}

.device-power {
  color: var(--accent);
  font-weight: 700;
  font-size: 1rem;
}

/* Ø´Ø§Ø´Ø© Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ */
.device-controls {
  background: rgba(255, 255, 255, 0.03);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
  border: 1px solid var(--border);
}

.device-row {
  display: grid;
  grid-template-columns: 2fr 1fr 1fr 1fr;
  gap: 15px;
  align-items: center;
  padding: 15px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.device-row:last-child {
  border-bottom: none;
}

.device-info {
  display: flex;
  align-items: center;
  gap: 15px;
}

.device-info i {
  font-size: 1.8rem;
  color: var(--accent);
}

.quantity-control {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.quantity-btn {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: none;
  background: var(--primary);
  color: white;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition);
}

.quantity-btn:hover {
  background: var(--accent);
  transform: scale(1.1);
}

.quantity-input {
  width: 60px;
  text-align: center;
  padding: 8px;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: white;
  font-weight: bold;
}

.hours-control {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  padding: 12px;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 10px;
}

.hours-label {
  font-size: 0.9rem;
  color: #94a3b8;
}

.hours-value {
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--accent);
}

.hours-buttons {
  display: flex;
  gap: 8px;
}

.hour-btn {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: none;
  background: rgba(255, 255, 255, 0.1);
  color: white;
  font-weight: bold;
  cursor: pointer;
  transition: var(--transition);
}

.hour-btn:hover {
  background: var(--primary);
}

/* Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
.results-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.result-card {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 25px 20px;
  text-align: center;
  transition: var(--transition);
}

.result-card:hover {
  transform: translateY(-5px);
  border-color: var(--primary);
}

.result-icon {
  font-size: 2.2rem;
  margin-bottom: 15px;
  color: var(--accent);
}

.result-title {
  font-size: 1rem;
  color: #94a3b8;
  margin-bottom: 10px;
}

.result-value {
  font-size: 1.8rem;
  font-weight: 800;
  color: white;
}

.inverter-card {
  background: linear-gradient(135deg, #1e293b, #0f172a);
  border: 2px solid var(--primary);
  border-radius: 12px;
  padding: 25px;
  margin-top: 20px;
  text-align: center;
}

.inverter-card .result-value {
  color: var(--accent);
  font-size: 1.5rem;
}

/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
.actions {
  display: flex;
  justify-content: space-between;
  margin-top: 40px;
  padding-top: 30px;
  border-top: 1px solid var(--border);
}

.btn {
  padding: 14px 28px;
  border-radius: 12px;
  border: none;
  font-weight: 700;
  font-size: 1rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  transition: var(--transition);
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), #115e59);
  color: white;
}

.btn-primary:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 20px rgba(15, 118, 110, 0.3);
}

.btn-secondary {
  background: rgba(255, 255, 255, 0.1);
  color: white;
  border: 1px solid var(--border);
}

.btn-secondary:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: var(--accent);
}

.btn-success {
  background: linear-gradient(135deg, var(--success), #16a34a);
  color: white;
}

.btn-success:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 20px rgba(34, 197, 94, 0.3);
}

.btn-whatsapp {
  background: linear-gradient(135deg, #25D366, #128C7E);
  color: white;
}

.btn-whatsapp:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 20px rgba(37, 211, 102, 0.3);
}

.result-actions {
  display: flex;
  gap: 15px;
  justify-content: center;
  flex-wrap: wrap;
}

/* Ø§Ù„ØªÙƒÙŠÙ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© */
@media (min-width: 992px) {
  .steps-container {
    flex-direction: row;
  }
  
  .steps-sidebar {
    width: 300px;
  }
}

@media (max-width: 768px) {
  .device-row {
    grid-template-columns: 1fr;
    gap: 15px;
  }
  
  .results-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .actions {
    flex-direction: column;
    gap: 15px;
  }
  
  .btn {
    width: 100%;
  }
  
  .result-actions {
    flex-direction: column;
  }
}

/* ØªÙ†Ø¨ÙŠÙ‡Ø§Øª */
.alert {
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 15px;
}

.alert-info {
  background: rgba(14, 165, 233, 0.1);
  border-left: 4px solid var(--secondary);
}

.alert i {
  font-size: 1.5rem;
}
</style>
</head>

<body>
<div class="container">
  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
  <header class="header">
    <div class="logo">
      <i class="fas fa-solar-panel"></i>
      <h1>ÙØ§Ø¯ÙŠ Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©</h1>
    </div>
    <p class="subtitle">Ø­Ø§Ø³Ø¨Ø© Ø°ÙƒÙŠØ© ØªÙ…ÙƒÙ†Ùƒ Ù…Ù† ØªØ­Ø¯ÙŠØ¯ Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙƒ Ø¨Ø¯Ù‚Ø© ÙˆØ§Ø­ØªØ±Ø§ÙÙŠØ© Ù„ØªØµÙ…ÙŠÙ… Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ© Ø§Ù„Ø£Ù…Ø«Ù„ Ù„Ù…Ù†Ø²Ù„Ùƒ</p>
  </header>

  <div class="steps-container">
    <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„Ù„Ø®Ø·ÙˆØ§Øª -->
    <aside class="steps-sidebar">
      <ul class="steps-list">
        <li class="step-item active" onclick="go(1)">
          <div class="step-number">1</div>
          <div class="step-info">
            <h3>Ø§Ø®ØªØ± Ø£Ø¬Ù‡Ø²ØªÙƒ</h3>
            <p>Ø§Ø®ØªØ± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ ØªØ´ØºÙŠÙ„Ù‡Ø§</p>
          </div>
        </li>
        <li class="step-item" onclick="go(2)">
          <div class="step-number">2</div>
          <div class="step-info">
            <h3>Ø­Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„</h3>
            <p>Ø­Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ ÙˆØ§Ù„Ù„ÙŠÙ„ÙŠ</p>
          </div>
        </li>
        <li class="step-item" onclick="go(3)">
          <div class="step-number">3</div>
          <div class="step-info">
            <h3>Ø§Ø·Ù„Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>
            <p>Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ùƒ</p>
          </div>
        </li>
      </ul>
      
      <div class="alert alert-info">
        <i class="fas fa-lightbulb"></i>
        <div>ØªÙ… ØªØµÙ…ÙŠÙ… Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…ØªÙˆØ³Ø· 5 Ø³Ø§Ø¹Ø§Øª Ø´Ù…Ø³ÙŠØ© ÙŠÙˆÙ…ÙŠØ§Ù‹</div>
      </div>
    </aside>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <main class="main-content">
      <!-- Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© -->
      <section id="s1" class="panel active">
        <div class="section-title">
          <i class="fas fa-plug"></i>
          <h2>Ø§Ø®ØªØ± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</h2>
        </div>
        
        <div class="alert alert-info">
          <i class="fas fa-info-circle"></i>
          <div>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¥Ù„Ù‰ Ù†Ø¸Ø§Ù…Ùƒ Ø§Ù„Ø´Ù…Ø³ÙŠ</div>
        </div>
        
        <div class="catalog" id="cards"></div>
        
        <div class="actions">
          <button class="btn btn-secondary" onclick="clearAll()">
            <i class="fas fa-trash-alt"></i> Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
          </button>
          <button class="btn btn-primary" onclick="go(2)">
            Ø§Ù„ØªØ§Ù„ÙŠ <i class="fas fa-arrow-left"></i>
          </button>
        </div>
      </section>

      <!-- Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ -->
      <section id="s2" class="panel">
        <div class="section-title">
          <i class="fas fa-clock"></i>
          <h2>Ø­Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„</h2>
        </div>
        
        <p style="margin-bottom: 20px; color: #94a3b8;">Ø§Ø¶Ø¨Ø· Ø¹Ø¯Ø¯ ÙƒÙ„ Ø¬Ù‡Ø§Ø² ÙˆØ³Ø§Ø¹Ø§Øª ØªØ´ØºÙŠÙ„Ù‡ Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‡Ø§Ø± ÙˆØ§Ù„Ù„ÙŠÙ„</p>
        
        <div id="devices"></div>
        
        <div class="actions">
          <button class="btn btn-secondary" onclick="go(1)">
            <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
          </button>
          <button class="btn btn-primary" onclick="go(3)">
            Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© <i class="fas fa-chart-bar"></i>
          </button>
        </div>
      </section>

      <!-- Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
      <section id="s3" class="panel">
        <div class="section-title">
          <i class="fas fa-chart-pie"></i>
          <h2>Ù†ØªØ§Ø¦Ø¬ Ø­Ø³Ø§Ø¨ Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©</h2>
        </div>
        
        <div class="results-grid" id="result"></div>
        
        <div class="inverter-card">
          <div class="result-icon">
            <i class="fas fa-bolt"></i>
          </div>
          <div class="result-title">Ø§Ù„Ø§Ù†ÙØ±ØªØ± Ø§Ù„Ù…Ù‚ØªØ±Ø­</div>
          <div class="result-value" id="inverter-result">Ø§Ù†ÙÙŠØ±ØªØ± 2.2 ÙƒÙŠÙ„Ùˆ</div>
        </div>
        
        <div class="result-actions">
          <button class="btn btn-success" onclick="saveImage()">
            <i class="fas fa-download"></i> Ø­ÙØ¸ ÙƒØµÙˆØ±Ø©
          </button>
          <button class="btn btn-whatsapp" onclick="sendWhatsApp()">
            <i class="fab fa-whatsapp"></i> Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
          </button>
          <button class="btn btn-secondary" onclick="go(1)">
            <i class="fas fa-redo"></i> Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
          </button>
        </div>
      </section>
    </main>
  </div>
</div>

<script>
// Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
const PANEL_WATT = 590;
const SUN_HOURS = 5;
const BATTERY_MARGIN = 1.2;

// ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©
const catalog = [
  {n:"Ø´Ø§Ø´Ø© ØªÙ„ÙØ²ÙŠÙˆÙ†", w:150, i:"ğŸ“º"},
  {n:"Ø«Ù„Ø§Ø¬Ø©", w:200, i:"ğŸ§Š"},
  {n:"Ù…Ø±ÙˆØ­Ø©", w:70, i:"ğŸŒ€"},
  {n:"Ù…ÙƒÙŠÙ Ø´Ø¨Ø§Ùƒ", w:1200, i:"â„ï¸"},
  {n:"Ù…ÙƒÙŠÙ Ø³Ø¨Ù„ÙŠØª", w:1800, i:"ğŸŒ¬ï¸"},
  {n:"ØºØ³Ø§Ù„Ø© Ø£Ø·Ø¨Ø§Ù‚", w:1500, i:"ğŸ§º"},
  {n:"ØºØ³Ø§Ù„Ø© Ù…Ù„Ø§Ø¨Ø³", w:600, i:"ğŸ‘•"},
  {n:"Ø¥Ù†Ø§Ø±Ø© LED", w:30, i:"ğŸ’¡"},
  {n:"Ù„Ø§Ø¨ØªÙˆØ¨", w:100, i:"ğŸ’»"},
  {n:"Ø³Ø®Ø§Ù† Ù…ÙŠØ§Ù‡", w:2000, i:"ğŸš¿"},
  {n:"Ù…ÙŠÙƒØ±ÙˆÙˆÙŠÙ", w:1200, i:"ğŸ²"},
  {n:"Ø±Ø§ÙˆØªØ±", w:15, i:"ğŸ“¡"},
  {n:"Ù…Ø¶Ø®Ø© Ù…Ø§Ø¡", w:750, i:"ğŸš°"},
  {n:"ÙØ±Ù† ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ", w:2500, i:"ğŸ”¥"},
  {n:"Ù…ÙƒÙˆØ§Ø©", w:1200, i:"ğŸ‘”"},
  {n:"Ø´Ø§Ø­Ù† Ù‡ÙˆØ§ØªÙ", w:10, i:"ğŸ”‹"}
];

// Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
let devices = [];
const cards = document.getElementById("cards");
const devicesDiv = document.getElementById("devices");
const resultDiv = document.getElementById("result");
const inverterResult = document.getElementById("inverter-result");

// ØªÙ‡ÙŠØ¦Ø© ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©
function initCatalog() {
  catalog.forEach(device => {
    const card = document.createElement("div");
    card.className = "device-card";
    card.innerHTML = `
      <div class="device-icon">${device.i}</div>
      <div class="device-name">${device.n}</div>
      <div class="device-power">${device.w} ÙˆØ§Ø·</div>
    `;
    
    card.onclick = () => {
      if (!devices.find(v => v.n === device.n)) {
        devices.push({
          n: device.n,
          w: device.w,
          i: device.i,
          c: 1,
          day: 1,
          night: 0
        });
        card.classList.add("added");
        renderDevices();
        updateStepStatus();
      }
    };
    
    cards.appendChild(card);
  });
}

// Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø®Ø·ÙˆØ§Øª
function go(step) {
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©
  document.querySelectorAll(".step-item").forEach((item, index) => {
    item.classList.toggle("active", index + 1 === step);
  });
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ÙˆØ­Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
  document.querySelectorAll(".panel").forEach((panel, index) => {
    panel.classList.toggle("active", index + 1 === step);
  });
  
  // Ø¥Ø°Ø§ ÙƒÙ†Ø§ ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© 3ØŒ Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„Ø­Ø³Ø§Ø¨
  if (step === 3) {
    calculateResults();
  }
}

// ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·ÙˆØ§Øª
function updateStepStatus() {
  const step2 = document.querySelectorAll(".step-item")[1];
  const step3 = document.querySelectorAll(".step-item")[2];
  
  if (devices.length > 0) {
    step2.classList.add("active-step");
    step3.classList.add("active-step");
  } else {
    step2.classList.remove("active-step");
    step3.classList.remove("active-step");
  }
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©
function renderDevices() {
  devicesDiv.innerHTML = "";
  
  if (devices.length === 0) {
    devicesDiv.innerHTML = `
      <div style="text-align: center; padding: 40px; color: #94a3b8;">
        <i class="fas fa-plug" style="font-size: 3rem; margin-bottom: 20px; display: block;"></i>
        <h3>Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ø£Ø¬Ù‡Ø²Ø© Ø¨Ø¹Ø¯</h3>
        <p>Ø§Ø±Ø¬Ø¹ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙˆØ§Ø®ØªØ± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØªÙ‡Ø§</p>
      </div>
    `;
    return;
  }
  
  devices.forEach((device, index) => {
    const deviceRow = document.createElement("div");
    deviceRow.className = "device-row";
    deviceRow.innerHTML = `
      <div class="device-info">
        <div style="font-size: 1.8rem;">${device.i}</div>
        <div>
          <h3 style="margin-bottom: 5px;">${device.n}</h3>
          <div style="color: var(--accent); font-weight: bold;">${device.w} ÙˆØ§Ø·</div>
        </div>
      </div>
      
      <div class="quantity-control">
        <button class="quantity-btn" onclick="updateQuantity(${index}, -1)">-</button>
        <input type="number" class="quantity-input" value="${device.c}" min="1" 
               onchange="updateQuantity(${index}, 0, this.value)">
        <button class="quantity-btn" onclick="updateQuantity(${index}, 1)">+</button>
      </div>
      
      <div class="hours-control">
        <div class="hours-label">Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø±</div>
        <div class="hours-value">${device.day}</div>
        <div class="hours-buttons">
          <button class="hour-btn" onclick="updateHours(${index}, 'day', -1)">-</button>
          <button class="hour-btn" onclick="updateHours(${index}, 'day', 1)">+</button>
        </div>
      </div>
      
      <div class="hours-control">
        <div class="hours-label">Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù„ÙŠÙ„</div>
        <div class="hours-value">${device.night}</div>
        <div class="hours-buttons">
          <button class="hour-btn" onclick="updateHours(${index}, 'night', -1)">-</button>
          <button class="hour-btn" onclick="updateHours(${index}, 'night', 1)">+</button>
        </div>
      </div>
    `;
    
    devicesDiv.appendChild(deviceRow);
  });
}

// ØªØ­Ø¯ÙŠØ« ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ù‡Ø§Ø²
function updateQuantity(index, change, newValue = null) {
  if (newValue !== null) {
    devices[index].c = parseInt(newValue) || 1;
  } else {
    devices[index].c += change;
    if (devices[index].c < 1) devices[index].c = 1;
  }
  renderDevices();
  calculateResults();
}

// ØªØ­Ø¯ÙŠØ« Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„
function updateHours(index, type, change) {
  if (type === 'day') {
    devices[index].day += change;
    if (devices[index].day < 0) devices[index].day = 0;
  } else {
    devices[index].night += change;
    if (devices[index].night < 0) devices[index].night = 0;
  }
  renderDevices();
  calculateResults();
}

// Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©
function clearAll() {
  devices = [];
  document.querySelectorAll(".device-card").forEach(card => {
    card.classList.remove("added");
  });
  renderDevices();
  updateStepStatus();
}

// Ø­Ø³Ø§Ø¨ Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ø§Ù†ÙØ±ØªØ±
function calculateInverter(watts) {
  if (watts < 800) return "Ø§Ù†ÙÙŠØ±ØªØ± 2.2 ÙƒÙŠÙ„Ùˆ ÙˆØ§Ø·";
  if (watts < 1800) return "Ø§Ù†ÙÙŠØ±ØªØ± 3.2 ÙƒÙŠÙ„Ùˆ ÙˆØ§Ø·";
  if (watts < 3300) return "Ø§Ù†ÙÙŠØ±ØªØ± 4.2 ÙƒÙŠÙ„Ùˆ ÙˆØ§Ø·";
  if (watts < 4800) return "Ø§Ù†ÙÙŠØ±ØªØ± 6.2 ÙƒÙŠÙ„Ùˆ ÙˆØ§Ø·";
  if (watts < 5800) return "Ø§Ù†ÙÙŠØ±ØªØ± 8.2 ÙƒÙŠÙ„Ùˆ ÙˆØ§Ø·";
  if (watts < 7800) return "Ø§Ù†ÙÙŠØ±ØªØ± 10.2 ÙƒÙŠÙ„Ùˆ ÙˆØ§Ø·";
  return "ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ù‡Ù†Ø¯Ø³ Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø©";
}

// Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
function calculateResults() {
  if (devices.length === 0) {
    resultDiv.innerHTML = `
      <div style="text-align: center; padding: 40px; color: #94a3b8; grid-column: 1 / -1;">
        <i class="fas fa-calculator" style="font-size: 3rem; margin-bottom: 20px; display: block;"></i>
        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­Ø³Ø§Ø¨</h3>
        <p>Ø§Ø±Ø¬Ø¹ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙˆØ§Ø®ØªØ± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØªÙ‡Ø§</p>
      </div>
    `;
    inverterResult.textContent = "Ø§Ù†ÙÙŠØ±ØªØ± 2.2 ÙƒÙŠÙ„Ùˆ ÙˆØ§Ø·";
    return;
  }
  
  let instantPower = 0;
  let dayConsumption = 0;
  let nightConsumption = 0;
  
  devices.forEach(device => {
    instantPower += device.w * device.c;
    dayConsumption += device.w * device.c * device.day;
    nightConsumption += device.w * device.c * device.night;
  });
  
  const totalConsumption = dayConsumption + nightConsumption;
  const batteryKwh = ((nightConsumption * BATTERY_MARGIN) / 1000).toFixed(2);
  const panels = Math.ceil(dayConsumption / (PANEL_WATT * SUN_HOURS));
  const inverter = calculateInverter(instantPower);
  
  // ØªØ­Ø¯ÙŠØ« Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ù†ÙØ±ØªØ±
  inverterResult.textContent = inverter;
  
  // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
  resultDiv.innerHTML = `
    <div class="result-card">
      <div class="result-icon">ğŸ”Œ</div>
      <div class="result-title">Ø§Ù„Ù‚Ø¯Ø±Ø© Ø§Ù„Ù„Ø­Ø¸ÙŠØ©</div>
      <div class="result-value">${instantPower.toLocaleString()} ÙˆØ§Ø·</div>
    </div>
    
    <div class="result-card">
      <div class="result-icon">â˜€ï¸</div>
      <div class="result-title">Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù†Ù‡Ø§Ø±</div>
      <div class="result-value">${dayConsumption.toLocaleString()} ÙˆØ§Ø·/Ø³Ø§Ø¹Ø©</div>
    </div>
    
    <div class="result-card">
      <div class="result-icon">ğŸŒ™</div>
      <div class="result-title">Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù„ÙŠÙ„</div>
      <div class="result-value">${nightConsumption.toLocaleString()} ÙˆØ§Ø·/Ø³Ø§Ø¹Ø©</div>
    </div>
    
    <div class="result-card">
      <div class="result-icon">ğŸ“Š</div>
      <div class="result-title">Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„ÙƒÙ„ÙŠ</div>
      <div class="result-value">${totalConsumption.toLocaleString()} ÙˆØ§Ø·/Ø³Ø§Ø¹Ø©</div>
    </div>
    
    <div class="result-card">
      <div class="result-icon">ğŸ”‹</div>
      <div class="result-title">Ø³Ø¹Ø© Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©</div>
      <div class="result-value">${batteryKwh} Ùƒ.Ùˆ.Ø³</div>
    </div>
    
    <div class="result-card">
      <div class="result-icon">ğŸŒ</div>
      <div class="result-title">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù„ÙˆØ§Ø­ Ø§Ù„Ø´Ù…Ø³ÙŠØ©</div>
      <div class="result-value">${panels} Ù„ÙˆØ­</div>
    </div>
  `;
}

// Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙƒØµÙˆØ±Ø©
function saveImage() {
  const resultsSection = document.getElementById("s3");
  
  html2canvas(resultsSection).then(canvas => {
    const link = document.createElement("a");
    link.download = `Ù†Ø¸Ø§Ù…-Ø§Ù„Ø·Ø§Ù‚Ø©-Ø§Ù„Ø´Ù…Ø³ÙŠØ©-${new Date().toLocaleDateString('ar-EG')}.png`;
    link.href = canvas.toDataURL("image/png");
    link.click();
    
    // ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
    alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙƒØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!");
  });
}

// Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
function sendWhatsApp() {
  if (devices.length === 0) {
    alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø£Ø¬Ù‡Ø²Ø© Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©");
    return;
  }
  
  let deviceList = "";
  devices.forEach(device => {
    deviceList += `- ${device.n}: ${device.c} Ø¬Ù‡Ø§Ø²ØŒ ${device.day} Ø³Ø§Ø¹Ø© Ù†Ù‡Ø§Ø±ØŒ ${device.night} Ø³Ø§Ø¹Ø© Ù„ÙŠÙ„\n`;
  });
  
  const instantPower = devices.reduce((sum, device) => sum + device.w * device.c, 0);
  const dayConsumption = devices.reduce((sum, device) => sum + device.w * device.c * device.day, 0);
  const nightConsumption = devices.reduce((sum, device) => sum + device.w * device.c * device.night, 0);
  const totalConsumption = dayConsumption + nightConsumption;
  const batteryKwh = ((nightConsumption * BATTERY_MARGIN) / 1000).toFixed(2);
  const panels = Math.ceil(dayConsumption / (PANEL_WATT * SUN_HOURS));
  const inverter = calculateInverter(instantPower);
  
  const message = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ

Ø£Ø±ØºØ¨ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ù„Ù†Ø¸Ø§Ù… Ø·Ø§Ù‚Ø© Ø´Ù…Ø³ÙŠØ©:

ğŸ“‹ *Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©*:
${deviceList}

ğŸ“Š *Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­Ø³Ø§Ø¨*:
ğŸ”Œ Ø§Ù„Ù‚Ø¯Ø±Ø© Ø§Ù„Ù„Ø­Ø¸ÙŠØ©: ${instantPower.toLocaleString()} ÙˆØ§Ø·
â˜€ï¸ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù†Ù‡Ø§Ø±: ${dayConsumption.toLocaleString()} ÙˆØ§Ø·/Ø³Ø§Ø¹Ø©
ğŸŒ™ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù„ÙŠÙ„: ${nightConsumption.toLocaleString()} ÙˆØ§Ø·/Ø³Ø§Ø¹Ø©
ğŸ“Š Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„ÙƒÙ„ÙŠ: ${totalConsumption.toLocaleString()} ÙˆØ§Ø·/Ø³Ø§Ø¹Ø©
ğŸ”‹ Ø³Ø¹Ø© Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©: ${batteryKwh} Ùƒ.Ùˆ.Ø³
ğŸŒ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù„ÙˆØ§Ø­ Ø§Ù„Ø´Ù…Ø³ÙŠØ©: ${panels} Ù„ÙˆØ­
âš¡ Ø§Ù„Ø§Ù†ÙÙŠØ±ØªØ± Ø§Ù„Ù…Ù‚ØªØ±Ø­: ${inverter}

Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ù‡ØªÙ…Ø§Ù…ÙƒÙ….`;

  window.open(`https://wa.me/249912341391?text=${encodeURIComponent(message)}`, "_blank");
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
window.onload = function() {
  initCatalog();
  renderDevices();
  calculateResults();
};
</script>
</body>
</html>